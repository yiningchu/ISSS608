---
title: "Take-home Exercise 3"
description: |
  A new article created using the Distill format.
author:
  - name: Chu Yi Ning 
    url: https://www.linkedin.com/public-profile/settings?trk=d_flagship3_profile_self_view_public_profile
    affiliation: SMU SCIS
    affiliation_url: https://scis.smu.edu.sg/
date: "`r Sys.Date()`"
output: distill::distill_article
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Overview

# Getting Started

```{r}
packages = c('tidyverse', 'patchwork', 'dplyr', 'lubridate',
             'knitr', 'zoo', 'ggplot2', 'plotly', 'scales', 'directlabels')
for(p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p, character.only = T)
}
```


## Data Cleaning

```{r}
data <- read_csv("data/FinancialJournal.csv")
dim(data)
```
### Order by Participant ID
```{r, results = 'hide'}
data_orderBypart <- data[order(data$participantId),]
```


```{r, echo = FALSE}
kable(head(data_orderBypart))
```

We can see there are some duplicates for Shelter and Education.


**distinct** function in dplyr will be used to remove duplicates

```{r}
data_clean <- data %>% distinct(participantId, timestamp, category, amount,
                   .keep_all = TRUE)
```

```{r, echo = FALSE}
data_clean2 <- data_clean[order(data_clean$participantId),]
```


```{r, echo = FALSE}
kable(head(data_clean2))
```

```{r}
dim(data_clean)
```

There are 1113 duplicates.

### Add a new column Month which extract month from timestamp
```{r}
data_clean <- data_clean %>%
  mutate(yearmonth = as.yearmon(timestamp))
```

```{r}
 
data_tidy <- data_clean %>% 
              group_by(yearmonth, category) %>%
              summarise(amount = abs(sum(amount)),
                             .groups = 'drop')

```

```{r}
data_tidy <- data_tidy %>%
  spread(category, amount)
```

```{r}
data_tidy <- data_tidy %>%
  mutate(CostofLiving = select(., Education, Food, Shelter) %>% rowSums(na.rm = TRUE))
```

```{r, echo = FALSE}
kable(head(data_tidy))
```

```{r}
p1 <- ggplot(data = data_tidy, aes(x = yearmonth, y = Wage), group = label) +
   geom_line(colour = "grey", aes(yearmonth, CostofLiving)) +
   geom_line(colour = "#408FA6")+
   scale_y_continuous(labels = comma)
ggplotly(p1)
```




